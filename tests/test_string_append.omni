;; test_string_append.omni - Comprehensive tests for string-append primitive
;;
;; Tests the prim_strcat function (exposed as string-append in OmniLisp)
;; which concatenates two string values with type coercion support.

;; ============================================================
;; Test Framework
;; ============================================================

(define test-count 0)
(define pass-count 0)
(define fail-count 0)

(define test-name [name] [expected] [actual]
  (set! test-count (+ test-count 1))
  (if (= expected actual)
      (do
        (set! pass-count (+ pass-count 1))
        (print "PASS:" name))
      (do
        (set! fail-count (+ fail-count 1))
        (print "FAIL:" name)
        (print "  Expected:" expected)
        (print "  Got:" actual))))

(define test-eq [name] [expected] [actual]
  (set! test-count (+ test-count 1))
  (if (equal? expected actual)
      (do
        (set! pass-count (+ pass-count 1))
        (print "PASS:" name))
      (do
        (set! fail-count (+ fail-count 1))
        (print "FAIL:" name)
        (print "  Expected:" expected)
        (print "  Got:" actual))))

;; ============================================================
;; Basic Concatenation Tests
;; ============================================================

(print "")
(print "=== Basic Concatenation Tests ===")

;; Test 1: Simple string concatenation
(test-name "basic concat"
  "helloworld"
  (string-append "hello" "world"))

;; Test 2: Concatenation with space
(test-name "concat with space"
  "hello world"
  (string-append "hello " "world"))

;; Test 3: Empty string + non-empty
(test-name "empty + non-empty"
  "hello"
  (string-append "" "hello"))

;; Test 4: Non-empty + empty string
(test-name "non-empty + empty"
  "hello"
  (string-append "hello" ""))

;; Test 5: Empty string + empty string
(test-name "empty + empty"
  ""
  (string-append "" ""))

;; ============================================================
;; Type Coercion Tests
;; ============================================================

(print "")
(print "=== Type Coercion Tests ===")

;; Test 6: String + integer
(test-name "string + int"
  "value: 42"
  (string-append "value: " 42))

;; Test 7: Integer + string
(test-name "int + string"
  "42: value"
  (string-append 42 ": value"))

;; Test 8: String + float
(test-name "string + float"
  "pi is 3.14"
  (string-append "pi is " 3.14))

;; Test 9: Multiple concatenations
(test-name "multiple concats"
  "abcde"
  (string-append (string-append "a" "b") (string-append "cde")))

;; Test 10: String with newlines
(test-name "newline concatenation"
  "line1\nline2"
  (string-append "line1\n" "line2"))

;; ============================================================
;; Special Character Tests
;; ============================================================

(print "")
(print "=== Special Character Tests ===")

;; Test 11: Concatenation with tabs
(test-name "tab concatenation"
  "col1\tcol2"
  (string-append "col1\t" "col2"))

;; Test 12: Concatenation with special chars
(test-name "special chars"
  "a@b#c"
  (string-append "a@" "b#c"))

;; ============================================================
;; Results
;; ============================================================

(print "")
(print "=== Test Results ===")
(print "Total:" test-count)
(print "Passed:" pass-count)
(print "Failed:" fail-count)

(if (= fail-count 0)
    (print "ALL TESTS PASSED!")
    (print "SOME TESTS FAILED"))

;; Return count of failures (0 = success)
fail-count
