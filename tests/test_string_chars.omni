;; test_string_chars.omni - Tests for string-chars primitive
;;
;; Tests string-chars function which splits a string into a list
;; of single-character strings. This is essential for character-level
;; string processing and manipulation.
;;
;; Run with: ./omni tests/test_string_chars.omni

;; ============================================================
;; Test Framework
;; ============================================================

(define test-count 0)
(define pass-count 0)
(define fail-count 0)

(define test-eq [name] [expected] [actual]
  (set! test-count (+ test-count 1))
  (if (equal? expected actual)
      (do
        (set! pass-count (+ pass-count 1))
        (print "PASS:" name))
      (do
        (set! fail-count (+ fail-count 1))
        (print "FAIL:" name)
        (print "  Expected:" expected)
        (print "  Got:" actual))))

;; ============================================================
;; Test 1: Empty string (edge case)
;; Tests that string-chars returns empty list for empty string
;; ============================================================

(print "")
(print "=== Test 1: Empty String ===")

(test-eq "empty string returns empty list"
  ()
  (string-chars ""))

;; ============================================================
;; Test 2: Single character string
;; Tests basic functionality with single character
;; ============================================================

(print "")
(print "=== Test 2: Single Character ===")

(test-eq "single character"
  '("a")
  (string-chars "a"))

(test-eq "single digit"
  '("1")
  (string-chars "1"))

(test-eq "single space"
  '(" ")
  (string-chars " "))

;; ============================================================
;; Test 3: Multi-character string
;; Tests splitting of longer strings
;; ============================================================

(print "")
(print "=== Test 3: Multi-Character Strings ===")

(test-eq "two characters"
  '("a" "b")
  (string-chars "ab"))

(test-eq "three characters"
  '("a" "b" "c")
  (string-chars "abc"))

(test-eq "word"
  '("h" "e" "l" "l" "o")
  (string-chars "hello"))

(test-eq "multiple words"
  '("h" "e" "l" "l" "o" " " "w" "o" "r" "l" "d")
  (string-chars "hello world"))

;; ============================================================
;; Test 4: Numeric strings
;; Tests that digits are properly split
;; ============================================================

(print "")
(print "=== Test 4: Numeric Strings ===")

(test-eq "digits"
  '("1" "2" "3" "4" "5")
  (string-chars "12345"))

(test-eq "number with zero"
  '("0" "1" "2" "0")
  (string-chars "0120"))

;; ============================================================
;; Test 5: Special characters and punctuation
;; Tests handling of non-alphabetic characters
;; ============================================================

(print "")
(print "=== Test 5: Special Characters ===")

(test-eq "spaces"
  '(" " " " " ")
  (string-chars "   "))

(test-eq "punctuation"
  '("," "." "!" "?")
  (string-chars ",.!?"))

(test-eq "special symbols"
  '("@" "#" "$" "%")
  (string-chars "@#$%"))

(test-eq "parentheses"
  '("(" ")")
  (string-chars "()"))

(test-eq "mixed alnum and punctuation"
  '("h" "e" "l" "l" "o" "," " " "w" "o" "r" "l" "d" "!")
  (string-chars "hello, world!"))

;; ============================================================
;; Test 6: Whitespace characters
;; Tests various whitespace types
;; ============================================================

(print "")
(print "=== Test 6: Whitespace Characters ===")

(test-eq "tab character"
  '("\t")
  (string-chars "\t"))

(test-eq "newline"
  '("\n")
  (string-chars "\n"))

(test-eq "mixed whitespace"
  '(" " "\t" "\n" " ")
  (string-chars " \t\n "))

;; ============================================================
;; Test 7: Case sensitivity
;; Tests that uppercase and lowercase are preserved
;; ============================================================

(print "")
(print "=== Test 7: Case Sensitivity ===")

(test-eq "all uppercase"
  '("A" "B" "C")
  (string-chars "ABC"))

(test-eq "all lowercase"
  '("a" "b" "c")
  (string-chars "abc"))

(test-eq "mixed case"
  '("A" "b" "C" "d")
  (string-chars "AbCd"))

;; ============================================================
;; Test 8: Reconstructed string identity
;; Tests that joining chars back equals original
;; ============================================================

(print "")
(print "=== Test 8: Identity Property ===")

;; Helper: rejoin chars into string
(define join-chars [char-list]
  (if (null? char-list)
      ""
      (string-append (car char-list)
                    (join-chars (cdr char-list)))))

(test-eq "join-chars identity test"
  "hello"
  (join-chars (string-chars "hello")))

(test-eq "empty string identity"
  ""
  (join-chars (string-chars "")))

(test-eq "special chars identity"
  "!@#$%"
  (join-chars (string-chars "!@#$%")))

;; ============================================================
;; Test 9: Single character with escape
;; Tests escape sequences are treated as single chars
;; ============================================================

(print "")
(print "=== Test 9: Escape Sequences ===")

(test-eq "backslash"
  '("\\")
  (string-chars "\\"))

(test-eq "quote"
  '("\"")
  (string-chars "\""))

;; ============================================================
;; Test 10: Long string performance
;; Tests that string-chars handles longer strings correctly
;; ============================================================

(print "")
(print "=== Test 10: Longer Strings ===")

(test-eq "ten chars"
  '("1" "2" "3" "4" "5" "6" "7" "8" "9" "0")
  (string-chars "1234567890"))

(test-eq "alphabet"
  '("a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z")
  (string-chars "abcdefghijklmnopqrstuvwxyz"))

;; ============================================================
;; Results
;; ============================================================

(print "")
(print "=== Test Results ===")
(print "Total:" test-count)
(print "Passed:" pass-count)
(print "Failed:" fail-count)

(if (= fail-count 0)
    (print "ALL TESTS PASSED!")
    (print "SOME TESTS FAILED"))

;; Return count of failures (0 = success)
fail-count
