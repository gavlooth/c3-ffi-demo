;; test_distinct.omni - Comprehensive tests for distinct primitive
;;
;; Tests prim_distinct function (exposed as distinct in OmniLisp)
;; which removes duplicate elements from lists and arrays while preserving order.

;; ============================================================
;; Test Framework
;; ============================================================

(define test-count 0)
(define pass-count 0)
(define fail-count 0)

(define test-eq [name] [expected] [actual]
  (set! test-count (+ test-count 1))
  (if (equal? expected actual)
      (do
        (set! pass-count (+ pass-count 1))
        (print "PASS:" name))
      (do
        (set! fail-count (+ fail-count 1))
        (print "FAIL:" name)
        (print "  Expected:" expected)
        (print "  Got:" actual))))

;; ============================================================
;; Array Distinct Tests
;; ============================================================

(print "")
(print "=== Array Distinct Tests ===")

;; Test 1: Empty array
(test-eq "empty array"
  []
  (distinct []))

;; Test 2: Single element array
(test-eq "single element array"
  [1]
  (distinct [1]))

;; Test 3: Array with no duplicates
(test-eq "array with no duplicates"
  [1 2 3 4 5]
  (distinct [1 2 3 4 5]))

;; Test 4: Array with all duplicates
(test-eq "array with all same elements"
  [7]
  (distinct [7 7 7 7]))

;; Test 5: Array with some duplicates
(test-eq "array with duplicates"
  [1 2 3 4]
  (distinct [1 2 2 3 3 3 4]))

;; Test 6: Array preserves first occurrence order
(test-eq "array preserves first occurrence"
  [3 1 4 2]
  (distinct [3 1 3 4 1 2 3]))

;; Test 7: Array with negative numbers
(test-eq "array with negative numbers"
  [-3 -1 0 2 4]
  (distinct [-3 -1 -3 0 2 2 4]))

;; Test 8: Array with floats
(test-eq "array with floats"
  [1.1 2.2 3.3]
  (distinct [1.1 2.2 1.1 3.3 2.2]))

;; Test 9: Array with mixed types
(test-eq "array with mixed types"
  [1 "two" 3.0]
  (distinct [1 1 "two" 3.0 1 "two" 3.0]))

;; ============================================================
;; List Distinct Tests
;; ============================================================

(print "")
(print "=== List Distinct Tests ===")

;; Test 10: Empty list
(test-eq "empty list"
  ()
  (distinct ()))

;; Test 11: Single element list
(test-eq "single element list"
  '(1)
  (distinct '(1)))

;; Test 12: List with no duplicates
(test-eq "list with no duplicates"
  '(1 2 3 4 5)
  (distinct '(1 2 3 4 5)))

;; Test 13: List with all duplicates
(test-eq "list with all same elements"
  '(7)
  (distinct '(7 7 7 7)))

;; Test 14: List with some duplicates
(test-eq "list with duplicates"
  '(1 2 3 4)
  (distinct '(1 2 2 3 3 3 4)))

;; Test 15: List preserves first occurrence order
(test-eq "list preserves first occurrence"
  '(3 1 4 2)
  (distinct '(3 1 3 4 1 2 3)))

;; Test 16: List with negative numbers
(test-eq "list with negative numbers"
  '(-3 -1 0 2 4)
  (distinct '(-3 -1 -3 0 2 2 4)))

;; Test 17: List with floats
(test-eq "list with floats"
  '(1.1 2.2 3.3)
  (distinct '(1.1 2.2 1.1 3.3 2.2)))

;; Test 18: List with mixed types
(test-eq "list with mixed types"
  '(1 "two" 3.0)
  (distinct '(1 1 "two" 3.0 1 "two" 3.0)))

;; ============================================================
;; Edge Case Tests
;; ============================================================

(print "")
(print "=== Edge Case Tests ===")

;; Test 19: Two identical elements
(test-eq "two identical array"
  [5]
  (distinct [5 5]))

;; Test 20: Two identical elements list
(test-eq "two identical list"
  '(5)
  (distinct '(5 5)))

;; Test 21: Pattern of alternating duplicates
(test-eq "alternating duplicates array"
  [1 2 3]
  (distinct [1 2 1 2 3 1 2]))

;; Test 22: Pattern of alternating duplicates list
(test-eq "alternating duplicates list"
  '(1 2 3)
  (distinct '(1 2 1 2 3 1 2)))

;; Test 23: Array with strings
(test-eq "array with strings"
  ["a" "b" "c"]
  (distinct ["a" "b" "a" "c" "b"]))

;; Test 24: List with strings
(test-eq "list with strings"
  '("a" "b" "c")
  (distinct '("a" "b" "a" "c" "b")))

;; Test 25: Array with symbols
(test-eq "array with symbols"
  [a b c]
  (distinct [a b a c b]))

;; Test 26: List with symbols
(test-eq "list with symbols"
  '(a b c)
  (distinct '(a b a c b)))

;; Test 27: Large array with many duplicates
(test-eq "large array many duplicates"
  [1 2 3 4 5]
  (distinct [1 1 2 2 3 3 4 4 5 5]))

;; Test 28: Large list with many duplicates
(test-eq "large list many duplicates"
  '(1 2 3 4 5)
  (distinct '(1 1 2 2 3 3 4 4 5 5)))

;; ============================================================
;; Non-Destructive Tests
;; ============================================================

(print "")
(print "=== Non-Destructive Tests ===")

;; Test 29: distinct doesn't modify original array
(define original-array [1 2 2 3 3])
(define distinct-array (distinct original-array))
(test-eq "original array unchanged"
  [1 2 2 3 3]
  original-array)

;; Test 30: distinct doesn't modify original list
(define original-list '(1 2 2 3 3))
(define distinct-list (distinct original-list))
(test-eq "original list unchanged"
  '(1 2 2 3 3)
  original-list)

;; Test 31: Distinct array is correct
(test-eq "distinct array correct"
  [1 2 3]
  distinct-array)

;; Test 32: Distinct list is correct
(test-eq "distinct list correct"
  '(1 2 3)
  distinct-list)

;; ============================================================
;; Idempotence Tests
;; ============================================================

(print "")
(print "=== Idempotence Tests ===")

;; Test 33: Double distinct is idempotent for array
(define arr [3 1 4 1 5 3])
(test-eq "double distinct array"
  (distinct arr)
  (distinct (distinct arr)))

;; Test 34: Double distinct is idempotent for list
(define lst '(3 1 4 1 5 3))
(test-eq "double distinct list"
  (distinct lst)
  (distinct (distinct lst)))

;; ============================================================
;; Results
;; ============================================================

(print "")
(print "=== Test Results ===")
(print "Total:" test-count)
(print "Passed:" pass-count)
(print "Failed:" fail-count)

(if (= fail-count 0)
    (print "ALL TESTS PASSED!")
    (print "SOME TESTS FAILED"))

;; Return count of failures (0 = success)
fail-count
