;; test_sort.omni - Comprehensive tests for sort primitive
;;
;; Tests prim_sort function (exposed as sort in OmniLisp)
;; which sorts lists and arrays non-destructively using default numeric comparison.

;; ============================================================
;; Test Framework
;; ============================================================

(define test-count 0)
(define pass-count 0)
(define fail-count 0)

(define test-eq [name] [expected] [actual]
  (set! test-count (+ test-count 1))
  (if (equal? expected actual)
      (do
        (set! pass-count (+ pass-count 1))
        (print "PASS:" name))
      (do
        (set! fail-count (+ fail-count 1))
        (print "FAIL:" name)
        (print "  Expected:" expected)
        (print "  Got:" actual))))

;; ============================================================
;; Array Sort Tests
;; ============================================================

(print "")
(print "=== Array Sort Tests ===")

;; Test 1: Empty array
(test-eq "empty array"
  []
  (sort []))

;; Test 2: Single element array
(test-eq "single element array"
  [1]
  (sort [1]))

;; Test 3: Already sorted array
(test-eq "already sorted array"
  [1 2 3 4 5]
  (sort [1 2 3 4 5]))

;; Test 4: Reverse sorted array
(test-eq "reverse sorted array"
  [1 2 3 4 5]
  (sort [5 4 3 2 1]))

;; Test 5: Random order array
(test-eq "random order array"
  [1 2 3 4 5]
  (sort [3 1 5 2 4]))

;; Test 6: Array with duplicates
(test-eq "array with duplicates"
  [1 1 2 2 3 3]
  (sort [3 2 1 3 2 1]))

;; Test 7: Array with negative numbers
(test-eq "array with negative numbers"
  [-5 -3 -1 0 2 4]
  (sort [0 2 -5 4 -3 -1]))

;; Test 8: Array with all same elements
(test-eq "array all same"
  [7 7 7 7]
  (sort [7 7 7 7]))

;; ============================================================
;; List Sort Tests
;; ============================================================

(print "")
(print "=== List Sort Tests ===")

;; Test 9: Empty list
(test-eq "empty list"
  ()
  (sort ()))

;; Test 10: Single element list
(test-eq "single element list"
  '(1)
  (sort '(1)))

;; Test 11: Already sorted list
(test-eq "already sorted list"
  '(1 2 3 4 5)
  (sort '(1 2 3 4 5)))

;; Test 12: Reverse sorted list
(test-eq "reverse sorted list"
  '(1 2 3 4 5)
  (sort '(5 4 3 2 1)))

;; Test 13: Random order list
(test-eq "random order list"
  '(1 2 3 4 5)
  (sort '(3 1 5 2 4)))

;; Test 14: List with duplicates
(test-eq "list with duplicates"
  '(1 1 2 2 3 3)
  (sort '(3 2 1 3 2 1)))

;; Test 15: List with negative numbers
(test-eq "list with negative numbers"
  '(-5 -3 -1 0 2 4)
  (sort '(0 2 -5 4 -3 -1)))

;; Test 16: List with all same elements
(test-eq "list all same"
  '(7 7 7 7)
  (sort '(7 7 7 7)))

;; ============================================================
;; Float Sorting Tests
;; ============================================================

(print "")
(print "=== Float Sorting Tests ===")

;; Test 17: Array with floats
(test-eq "array with floats"
  [1.1 2.2 3.3 4.4 5.5]
  (sort [5.5 3.3 1.1 4.4 2.2]))

;; Test 18: List with floats
(test-eq "list with floats"
  '(1.1 2.2 3.3 4.4 5.5)
  (sort '(5.5 3.3 1.1 4.4 2.2)))

;; Test 19: Mixed floats and ints
(test-eq "mixed floats and ints"
  [1 2.5 3 4.5 5]
  (sort [4.5 2.5 1 5 3]))

;; Test 20: Negative floats
(test-eq "negative floats"
  [-3.3 -1.1 0 2.2 4.4]
  (sort [2.2 0 -3.3 4.4 -1.1]))

;; ============================================================
;; Non-Destructive Tests
;; ============================================================

(print "")
(print "=== Non-Destructive Tests ===")

;; Test 21: Sort doesn't modify original array
(define original-array [5 3 1 4 2])
(define sorted-array (sort original-array))
(test-eq "original array unchanged"
  [5 3 1 4 2]
  original-array)

;; Test 22: Sorted array is correct
(test-eq "sorted array correct"
  [1 2 3 4 5]
  sorted-array)

;; Test 23: Sort doesn't modify original list
(define original-list '(5 3 1 4 2))
(define sorted-list (sort original-list))
(test-eq "original list unchanged"
  '(5 3 1 4 2)
  original-list)

;; Test 24: Sorted list is correct
(test-eq "sorted list correct"
  '(1 2 3 4 5)
  sorted-list)

;; ============================================================
;; Edge Cases and Idempotence
;; ============================================================

(print "")
(print "=== Edge Cases and Idempotence ===")

;; Test 25: Double sort is idempotent for array
(define arr [3 1 4 1 5 9 2 6])
(test-eq "double sort array"
  (sort arr)
  (sort (sort arr)))

;; Test 26: Double sort is idempotent for list
(define lst '(3 1 4 1 5 9 2 6))
(test-eq "double sort list"
  (sort lst)
  (sort (sort lst)))

;; Test 27: Two element swap
(test-eq "two element array swap"
  [1 2]
  (sort [2 1]))

;; Test 28: Two element list swap
(test-eq "two element list swap"
  '(1 2)
  (sort '(2 1)))

;; Test 29: Large array (10 elements)
(test-eq "large array"
  [1 2 3 4 5 6 7 8 9 10]
  (sort [10 9 8 7 6 5 4 3 2 1]))

;; Test 30: Large list (10 elements)
(test-eq "large list"
  '(1 2 3 4 5 6 7 8 9 10)
  (sort '(10 9 8 7 6 5 4 3 2 1)))

;; ============================================================
;; Results
;; ============================================================

(print "")
(print "=== Test Results ===")
(print "Total:" test-count)
(print "Passed:" pass-count)
(print "Failed:" fail-count)

(if (= fail-count 0)
    (print "ALL TESTS PASSED!")
    (print "SOME TESTS FAILED"))

;; Return count of failures (0 = success)
fail-count
